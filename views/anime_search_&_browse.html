<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Kiroku - Anime tracker and browser" />
    <title>Kiroku</title>
    <!-- Preload critical CSS and preconnect to CDN to improve performance -->
    <link rel="preload" href="../public/css/anime-search.css" as="style" />
    <link rel="stylesheet" href="../public/css/anime-search.css" />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
    <link
      rel="preload"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      as="style"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
  </head>

  <body class="page">
    <script>
      // Proteger página: si no está autenticado, redirigir a login
      if (!AuthManager || !AuthManager.isAuthenticated()) {
        window.location.href = "user_authentication.html";
      }
    </script>

    <!-- HEADER -->
    <header class="header">
      <div class="header__left">
        <div class="header__logo">
          <img
            src="/logo-kiroku.png"
            alt="Kiroku logo"
            class="header__logo-img"
          />
          <a href="#" class="header__logo-title">Kiroku</a>
        </div>

        <nav class="nav">
          <a href="#" class="nav__link">Home</a>
          <a href="#" class="nav__link">My List</a>
          <a href="#" class="nav__link">Browse</a>
        </nav>
      </div>

      <div class="header__right">
        <div class="search-box">
          <span class="search-box__icon"><i class="fas fa-search"></i></span>
          <input class="search-box__input" type="search" placeholder="Search" />
        </div>

        <!-- Use an img with lazy loading to avoid blocking initial render -->
        <img
          class="avatar"
          loading="lazy"
          alt="User avatar"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuAUhNUZ-TaKkscdiaeWbU0zeYhqkCIqBbaFtSE9LonQSSwOArZDYalO3sF3ner7S_9q4xKkjb2TQqcPzEwDjXSKI3JpYSDtqFwAseYSfUTMJoAcEgiVTVuaMRAlCHNi02Qixf3vCh6K-ahol5hrFkEZliXQGNgu2aKpxjMpDKpP24N6FHlCUOTGuk8k6TPHxuTIl2zTJuANmigGbvJhdUAQLsDJ6GiNXzk-0aGrUKvnoQSs4SklgE2cIt7mmf1UXgGQBwITTdjgXP4"
        />
      </div>
    </header>

    <!-- MAIN -->
    <main class="main">
      <section class="search">
        <div class="search__bar">
          <span class="search__icon"><i class="fas fa-search"></i></span>
          <input
            class="search__input"
            type="search"
            placeholder="Search for an anime, like 'Attack on Titan'"
          />
        </div>

        <div class="search__filters">
          <button class="search__button">Genre</button>
          <button class="search__button">Season</button>
          <button class="search__button">Rating</button>
        </div>
      </section>

      <!-- ANIME GRID -->
      <section class="anime-grid">
        <article class="anime-card">
          <!-- Use img with loading="lazy" for better performance -->
          <img
            class="anime-card__cover"
            loading="lazy"
            alt="Attack on Titan cover"
            src="https://lh3.googleusercontent.com/aida-public/AB6AXuBNywvxzPxBx-wQKwF4_j9xGF86WOayLc-r-zKqC_fxOIv7iHlof_cY2pQ8xC_nmMPH6nS3zSE1FacXFhqTARX17PkrIY9y1SzGdIbWKrqpHb3exoCOMA4MqJi3YVpivb__KLhLmZxWdPLQY6zjGxMYNW2W-a00WrhtEAh2imqfd3ZRd0juVbxPjkYriIpM4iT8FEQ5VpetJB_sFkIE5AlCBlUUKiLPOEBv1E0HB_pDWYyZLWROBmYZVdf8z9ddyhfKnSyktG9BacE"
          />

          <div class="anime-card__info">
            <h3 class="anime-card__title">Attack on Titan</h3>
            <p class="anime-card__meta">Action, Fantasy | 4 Seasons</p>
          </div>
        </article>

        <article class="anime-card">
          <img
            class="anime-card__cover"
            loading="lazy"
            alt="Demon Slayer cover"
            src="https://lh3.googleusercontent.com/aida-public/AB6AXuBz4-XZCWtl9iWFXJop7ahTfXNwHdEgWnj6tIkCAGYbt5jYmb6lsz-25HEIGjc9JYoGO453kEV2iKZw4igbTTlDMaIKa-Mu0BairIJDUWYNsdJTvvk9GAFnEBSXNYeRCw8OLrd-3OjAxuZJtkHZ0yjDiupO8GQoWEIW3iwaPjjHYW2NOsJq1aRFBAUZxTqC4GShvsP-fRV5juD61FzKoSg5n9CUvGkkGFrgsjz42fe7GcnK90VnRWoGW4BzjKe_TJpWaLEQYcsPqkk"
          />

          <div class="anime-card__info">
            <h3 class="anime-card__title">Demon Slayer</h3>
            <p class="anime-card__meta">Action, Adventure | 3 Seasons</p>
          </div>
        </article>
      </section>
    </main>
    <!-- Load app.js and the page logic with defer so parsing isn't blocked.
         app.js must come first (provides UI / API). -->
    <script src="/app.js" defer></script>
    <script src="/js/anime-search.js" defer></script>
    <script>
      // Verificar autenticación antes de mostrar contenido
      if (!AuthManager.isAuthenticated()) {
        window.location.href = "login.html";
      } else {
        AuthManager.updateUIForAuth();
      }
    </script>
  </body>
</html>
